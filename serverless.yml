org: lynicis
app: ulak-scrapping
service: ulak-scrapping
plugins:
  - serverless-offline

build:
  esbuild: 
    bundle: true
    external:
      - "@sparticuz/chromium"
      - puppeteer-core
      - puppeteer-extra
      - puppeteer-extra-plugin-stealth
      - cheerio
      - "@upstash/redis"

provider:
  name: aws
  runtime: nodejs22.x

functions:
  fetchFollowings:
    handler: handlers/fetch-followings.handler
    timeout: 60
    environment:
      UPSTASH_REDIS_REST_URL: ${env:UPSTASH_REDIS_REST_URL}
      UPSTASH_REDIS_REST_TOKEN: ${env:UPSTASH_REDIS_REST_TOKEN}
      PUPPETEER_CHROMIUM_PATH: ${env:PUPPETEER_CHROMIUM_PATH}
    events:
      - http:
          cors: true
          method: GET
          path: /followings/platforms/{platformName}/users/{username}
          request:
            schemas:
              application/json: ${file(handlers/fetch-followings.schema.json)}
